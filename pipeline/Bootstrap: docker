Bootstrap: docker
From: ubuntu:20.04
%help
    Container for TrEmolo v2.0
    https://github.com/DrosophilaGenomeEvolution/TrEMOLO
    Includes 
        Blast 2.2+
        Bedtools2
        RaGOO
        Assemblytics
        Snakemake 5.5.2+
        Minimap2 2.16+
        Samtools 1.10+
        Sniffles 1.0.10+
        SVIM 1.4.2+
        Flye 2.8+
        Assembly-stats
        libfontconfig1-dev ***
        Python libs
            Biopython
            Pandas
            Numpy
            pylab
        R libs
            ggplot2
            RColorBrewer
            extrafont
            rmarkdown ***
            kableExtra ***
%labels
    VERSION "TrEMOLO v2.0"
    Maintainer Francois Sabot <francois.sabot@ird.fr>
    March, 2021
%post
    # faster apt downloads
    export DEBIAN_FRONTEND=noninteractive
    export LC_ALL=C
    (
        . /etc/os-release
        cat << _EOF_ > mirror.txt
deb mirror://mirrors.ubuntu.com/mirrors.txt ${UBUNTU_CODENAME} main restricted universe multiverse
deb mirror://mirrors.ubuntu.com/mirrors.txt ${UBUNTU_CODENAME}-updates main restricted universe multiverse
deb mirror://mirrors.ubuntu.com/mirrors.txt ${UBUNTU_CODENAME}-backports main restricted universe multiverse
deb mirror://mirrors.ubuntu.com/mirrors.txt ${UBUNTU_CODENAME}-security main restricted universe multiverse
_EOF_
        mv /etc/apt/sources.list /etc/apt/sources.list.bak
        cat mirror.txt /etc/apt/sources.list.bak > /etc/apt/sources.list
    )
    # apt dependencies
    apt update
    apt install -y \
        apt-utils \
        autoconf \
        automake \
        cmake \
        gcc \
        build-essential \
        software-properties-common \
        tar \
        unzip \
        wget \
        zlib1g-dev \
        sudo \
        git-core \
        locales \
        python3-pip \
        ncbi-blast+ \
        samtools \
        bedtools \
        minimap2 \
        sniffles \
        snakemake \
        assemblytics \
        racon \
        r-base \
    # R dependencies
    R --slave -e 'install.packages("RColorBrewer")'
    R --slave -e 'install.packages("ggplot2")'
    R --slave -e 'install.packages("extrafont")'
    
    #Python libs
    python3 -m pip install biopython pandas numpy matplotlib svim intervaltree scipy
       
    # build variables
    export TOOLDIR=/opt/tools
    #Preparing Directories
    mkdir -p $TOOLDIR
    
    #installing Flye 2.8+
    cd $TOOLDIR
    git clone https://github.com/fenderglass/Flye
    cd Flye
    python3 setup.py install
    
    #install Assembly-stats
    cd $TOOLDIR
    git clone https://github.com/sanger-pathogens/assembly-stats.git
    cd assembly-stats
    mkdir build
    cd build
    cmake ..
    make
    make install
    
    #install RaGOO
    git clone https://github.com/malonge/RaGOO.git
    cd RaGOO
    python3 setup.py install
    
    #install TrEMOLO
    cd $TOOLDIR
    git clone https://github.com/DrosophilaGenomeEvolution/TrEMOLO.git
    
%environment
    
%runscript
    exec "$@"